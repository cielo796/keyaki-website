---
const currentPath = Astro.url.pathname;

const navigation = [
  { name: 'ホーム', href: '/' },
  { name: '事業所案内', href: '/about/' },
  { 
    name: '支援サービス', 
    href: '/services/',
    children: [
      { name: '特別養護老人ホーム・ショートステイ', href: '/services/nursing-home/' },
      { name: 'ユニット型', href: '/services/unit/' },
      { name: 'デイサービス', href: '/services/day-service/' },
      { name: '居宅介護支援事業所', href: '/services/care-support/' },
      { name: '食事サービス', href: '/services/meal/' },
      { name: 'リハビリ（機能訓練）', href: '/services/rehabilitation/' },
    ]
  },
  { name: 'イベント・行事', href: '/events/' },
  { name: 'お問い合わせ', href: '/contact/' },
];

function isActive(href: string): boolean {
  if (href === '/') {
    return currentPath === '/';
  }
  return currentPath.startsWith(href);
}
---

<header class="bg-white shadow-sm sticky top-0 z-50">
  <!-- Top bar -->
  <div class="bg-keyaki-800 text-white py-2">
    <div class="container-main flex justify-between items-center text-sm">
      <p class="hidden sm:block">社会福祉法人 丹波柏原福祉会</p>
      <div class="flex items-center gap-6">
        <a href="tel:0795-73-1185" class="flex items-center gap-2 hover:text-keyaki-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
          <span>0795-73-1185</span>
        </a>
        <span class="hidden md:inline text-keyaki-300">|</span>
        <p class="hidden md:flex items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12 6 12 12 16 14"/>
          </svg>
          <span>受付 8:30〜17:30</span>
        </p>
      </div>
    </div>
  </div>

  <!-- Main navigation -->
  <div class="container-main">
    <div class="flex items-center justify-between py-4">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        <div class="w-12 h-12 bg-keyaki-700 rounded-full flex items-center justify-center text-white group-hover:bg-keyaki-600 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22v-7l-2-2"/>
            <path d="M17 8v.8A6 6 0 0 1 13.8 14v0a6.5 6.5 0 0 1-1.8 4.5v0"/>
            <path d="M7 8v.8A6 6 0 0 0 10.2 14v0a6.5 6.5 0 0 0 1.8 4.5v0"/>
            <path d="M12 2a4 4 0 0 0-4 4c0 1.5.8 2.8 2 3.5"/>
            <path d="M12 2a4 4 0 0 1 4 4c0 1.5-.8 2.8-2 3.5"/>
            <path d="M12 6a2 2 0 0 0-2 2"/>
            <path d="M12 6a2 2 0 0 1 2 2"/>
          </svg>
        </div>
        <div>
          <h1 class="text-xl md:text-2xl font-serif font-medium text-keyaki-800">柏原けやき苑</h1>
          <p class="text-xs text-gray-500 hidden sm:block">利用者様に満足していただける介護サービスを</p>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <nav class="hidden lg:flex items-center gap-1">
        {navigation.map((item) => (
          <div class="relative group">
            <a 
              href={item.href}
              class={`px-4 py-2 text-sm font-medium rounded-md transition-colors ${
                isActive(item.href) 
                  ? 'text-keyaki-700 bg-keyaki-50' 
                  : 'text-gray-700 hover:text-keyaki-700 hover:bg-keyaki-50'
              }`}
            >
              {item.name}
              {item.children && (
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 inline-block ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="m6 9 6 6 6-6"/>
                </svg>
              )}
            </a>
            {item.children && (
              <div class="absolute left-0 mt-1 w-64 bg-white rounded-lg shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="py-2">
                  {item.children.map((child) => (
                    <a 
                      href={child.href}
                      class="block px-4 py-2 text-sm text-gray-700 hover:bg-keyaki-50 hover:text-keyaki-700 transition-colors"
                    >
                      {child.name}
                    </a>
                  ))}
                </div>
              </div>
            )}
          </div>
        ))}
      </nav>

      <!-- Mobile menu button -->
      <button 
        type="button"
        class="lg:hidden p-2 text-gray-700 hover:text-keyaki-700 hover:bg-keyaki-50 rounded-md transition-colors"
        id="mobile-menu-button"
        aria-label="メニューを開く"
        aria-expanded="false"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" id="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" x2="20" y1="12" y2="12"/>
          <line x1="4" x2="20" y1="6" y2="6"/>
          <line x1="4" x2="20" y1="18" y2="18"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" id="close-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M18 6 6 18"/>
          <path d="m6 6 12 12"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Navigation -->
  <div class="lg:hidden hidden" id="mobile-menu">
    <div class="border-t border-gray-100 bg-white">
      <nav class="container-main py-4 space-y-1">
        {navigation.map((item) => (
          <div>
            <a 
              href={item.href}
              class={`block px-4 py-3 text-sm font-medium rounded-md ${
                isActive(item.href) 
                  ? 'text-keyaki-700 bg-keyaki-50' 
                  : 'text-gray-700 hover:text-keyaki-700 hover:bg-keyaki-50'
              }`}
            >
              {item.name}
            </a>
            {item.children && (
              <div class="ml-4 mt-1 space-y-1">
                {item.children.map((child) => (
                  <a 
                    href={child.href}
                    class="block px-4 py-2 text-sm text-gray-600 hover:text-keyaki-700 hover:bg-keyaki-50 rounded-md"
                  >
                    {child.name}
                  </a>
                ))}
              </div>
            )}
          </div>
        ))}
      </nav>
    </div>
  </div>
</header>

<script>
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  menuButton?.addEventListener('click', () => {
    const isOpen = mobileMenu?.classList.contains('hidden');
    
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
    menuButton?.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
  });
</script>
